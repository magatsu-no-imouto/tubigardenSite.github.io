<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scheduled Reservation Page</title>
    <style>
         body, h1, h2, p {
    margin: 0;
    padding: 0;
}
body {
            font-family: Arial, Helvetica, sans-serif;
            background-color: #f2f2f2;
            margin: 0;
            padding: 0;
            display:inline-flexbox;
            justify-content: center;
            align-items: center;
            height: 100vh;
           
            background-image: url('media/tubigan.jpg'); 
    background-repeat: no-repeat;
    background-size: cover;
    background-attachment: fixed;
    background-size: cover; 
    background-position: center;
    background-repeat: no-repeat; 
    margin: 0; 
    padding: 0;
        }

        .header-content {
      position: relative;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: #fff;
    }
        header.style1 {
        display: flex;
        background-color: #007BFF;
        color: #fff;
        text-align: center;
        padding: 5px ;
        }
        header.style1 a {
         display: inline-block;
         background-color: #fff;
         color: #007BFF;
         padding: 10px 20px;
         text-decoration: none;
         border-radius: 5px;
         margin-top: 20px;
         font-weight: bold;
        }
        div.style1 {
    padding: 50px 0px 0px 155px;
}

        header.style2 {
           background-color: #7cafc9;
           color: #ffffff;
          text-align: center;
          padding: 5px ;
        }
        header.style2 a {
         display: inline-block;
         background-color: #fff;
         color: #007BFF;
         padding: 10px 20px;
         text-decoration: none;
         border-radius: 5px;
         margin-top: 20px;
         font-weight: bold;
        }
        
        header.s2 nav{
          display: flex;
          justify-content: center;
          align-items: center;
        }
        header.style2 nav a{
          display: inline-block;
          padding: 10px 20px;
          text-decoration: none;
          color: #ff0202;
          background-color: rgb(226, 226, 83);
          border-radius: 35px;
          margin: 0 10px;
          transition: cubic-bezier(0.075, 0.82, 0.165, 1);
        }
        header.style2 nav a:hover{
          background-color: #007BFF;

        }
 .main-heading{
    font-size: 20px;
    display: inline-block;
    justify-content: center;
    text-align: center;
    margin-right: 340px;

}
.headText{
        font-size: 15px;
        display: inline-block;
justify-content: center;
text-align: center;
margin-right: 340px;
}
header {
      flex: 1;
      position: relative;
      overflow: hidden;
    }
    header > img {
    height: 100px;
    width: auto;
    margin-right:auto;
    margin-left: - auto;
}

    footer {
         text-align: center;
         background-color: #333;
         color: #fff;
         padding: 0px ;
         margin-top: 200px;
        }

    .register-container {
            background-color: #fff;
            border-radius: 18px;
            padding: 45px;
            margin-top: 90px;
            margin-left: 475px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 300px;
        }

        .register-container h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .form-group button {
            width: 100%;
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
        }

        .form-group button:hover {
            background-color: #0056b3;
        }

       
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(100%); 
            background-color: rgba(233, 230, 230, 0.8);
            box-shadow: 0 60px 80px rgba(0, 0, 0, 0.1);
            opacity: 100%;
        }

        h2{
margin-top: 30px;
color: #050505;
}
        form {
            border: px solid #ccc;
            padding: 20px;
            margin-top: 20px;
            
        }
        label {
            display: block;
            margin-bottom: 10px;

        }
        input,
        select {
            width: 95%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            display: inline-block;
            background-color: #007bff;
            color: #fff;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ccc;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .table-container {
            width: 95%;
            height: 200px;
            overflow-x: auto;
            overflow-y: auto;
            margin: 0 auto;
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(100%); 
            background-color: rgba(233, 230, 230, 0.8);
            box-shadow: 0 60px 80px rgba(0, 0, 0, 0.1);
            opacity: 100%;
            border: 1px;
        }
        .smol{
            width: 6.05%;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .linkWithFunction{
    cursor: pointer;
}
</style>

</head>
<body>
    <header class="style1">
        <img src="media/5.png" alt="logo">

        <div class="style1">
        <h1 class="main-heading"> Tubigan Garden Resort</h1>
        <p class="headText">Tubigan Garden Resort located at Paliparan 3, Dasmari√±as, Cavite | ùôîùôäùôêùôç ùôâùôÄùôìùôè ùòºùòøùôëùôÄùôâùôèùôêùôçùôÄ ùôéùôãùôäùôè‚ùó</p>
        <p class="headText">Affordable Summer PlayGround</p><br><br>
        </div>
    </header>

    <header class="style2">
        <nav>
        <a href= "Admin.html">Home</a>
        <a href= "AdminUser.html">Admin Accounts</a>
        <a href= "AdminMembers.html">Member Accounts</a>
        <a href= "AdminReshced.html">Reschedules</a>
        <a href="AdminRunBal.html">Customer's Running Balance</a>
        <a href="AdminPromos.html">Promos</a>
        <a href="AdminRooms.html">Rooms</a><br><br>
        <a href="AdminCheckin.html">Check-In A Customer</a>
        <a class="linkWithFunction" onclick="logout()">Log Out</a>
    </nav>
    </header>

    <h2> Schedule</h2><br>
    <div class="container">
            <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th></th>
                        <th>Check In Date</th>
                        <th>Booked Date</th>
                        <th>Reservation ID</th>
                        <th>Username</th>
                        <th>Customer Name</th>
                        <th>Phone Number</th>
                        <th>Email</th>
                        <th>Party Size</th>
                        <th>Chosen Room</th>
                        <th>Tour Type</th>
                        <th>Price</th>
                        <th>Availed Promo</th>
                        <th>Payment Method</th>
                        <th>Payment Status</th>
                        <th>Reservation Status</th>
                    </tr>
                </thead>
                <tbody id="reservation-table">
                    <!-- Reservation datum will be displayed here -->
                </tbody>
            </table>
        </div>
            <form id="fomres">
                <label>Reservation ID</label>
                <input type="text" id="resID" name="resID">
                <label>Username:</label>
                <input type="text" id="username" name="rescID" >
                <label>Name:</label>
                <input type="text" id="fullname" name="rescName" >
                <label>Email:</label>
                <input type="email" id="email" name="rescEmail" >
                <label>Phone Number:</label>
                <input type="number" id="phono" name="rescPhono" oninput="javascript: if (this.value.length > 11) this.value = this.value.slice(0, 11);">
                <label>Number of Adults:</label>
                <input type="number" id="pax" name="resPax" value="1">
                <label>Number of Children:</label>
                <input type="number" id="cax" name="resCax" value="0">
                <label>Chosen Room:</label>
                <label id="roomArray"></label>
                <select id="selRoomR" name="resRoomName">
                    <option id="default" value=0>Loading. . .</option>
                </select>
                <button type="button" class="btn" onclick="more()">Add More</button>
                <button id="arrayRem" type="button" class="btn" onclick="reduce()">Remove One</button>
                <label id="e"></label>
                <label id="f"></label>
                <label>Booked Visit Date:</label>
                <input type="date" id="book-in" name="resBookeDate" >
                <label>Check-In Date:</label>
                <input type="date" id="check-in" name="resCheckDate" >
                <label>Check-Out Date:</label>
                <input type="date" id="check-out" name="resCheckDate2" >
                <label>Tour Type:</label>
                <select id="selTour" name="resTour">
                    <option></option>
                    <option>Day Tour</option>
                    <option>Night Tour</option>
                    <option>Overnight</option>
                </select>
                <input class="smol" type="number" id="daysaf" value=0 min=0 ><span id="daysText" >Nights</span>
                <label>Price</label>
                <input id="price" name="resPrice" value="300.00" readonly><!--this is supposed to dynamically change as selRoom is manipulated-->
                <label id="pricePlus">
                    <!--once arrayCount=1, this will display the price the selRoom will be adding due to there being an array-->
                </label>
                <label>Availed Promo:</label>
                <select id="selPromo">
                    <option id="default-Promo" value=""></option>
                    <!--Oh boy, another one of these-->
                </select>
                <label>Payment Methodoloy:</label>
                <select id="selPayMeth" name="resPayMeth">
                    <option value=""></option>
                    <option value="GcashOL">Gcash - Online</option>
                    <option value="GcashOS">Gcash - Onsite</option>
                    <option value="Cash">Cash </option>
                    <option value="WalkIn">Walk In</option>
                </select>
                <label>Payment Status</label>
                <select id="selPayStat" name="resPayStat">
                    <option value=""></option>
                    <option value="Paid">Paid</option>
                    <option value="Half Paid">Half Paid</option>
                    <option value="Unpaid">Pending</option>
                </select>
                <label>Reservation Status</label>
                <select id="selResStat">
                    <option></option>
                    <option>Reserved</option>
                    <option>Checked In</option>
                    <option>Cancelled</option>
                </select>
                <span hidden id="inProgInd" hidden>Processing. Please wait. . .</span>
                <button type="button" id="addRes" onclick="validator1()">Add Reservation</button>
                <button type="button" id="updateRes" onclick="updateR()">Update Reservation</button>
                <button type="button" id="searchRes" onclick="searchRes()">Search Reservation</button> 
                <button type="button" id="deleteRes" onclick="deletR()">Cancel Reservation</button>
            </form>
        </div>
    </div>

    <script>
    const payStatf=document.getElementById('selPayStat').options[document.getElementById('selPayStat').selectedIndex]
    const stat=document.getElementById('selResStat').options[document.getElementById('selResStat').selectIndex]
    const dt = new Date()
    fetch('/reservation-data').then(response => {
    if (response.ok) {
      return response.json(); 
    } else {
      throw new Error('Error fetching data');
    }
  })
  .then(data =>{
    const reservData=document.getElementById('reservation-table');
    data.forEach(item=>{
            const r=document.createElement('tr');
    r.innerHTML=`
    <td><button class="btn" onclick="searchRes('${item.resID}')">Search</button></td>
    <td>${item.resCheckinDate}</td>
    <td>${item.resCheckoutDate}</td>
    <td>${item.resID}</td>
    <td>${item.resmID}</td>
    <td>${item.resmName}</td>
    <td>${item.resmPhono}</td>
    <td>${item.resmEmail}</td>
    <td>${item.resPax}</td>
    <td>${item.resRoomName}</td>
    <td>${item.resTour}</td>
    <td>${item.resPrice}</td>
    <td>${item.resPromo}</td>
    <td>${item.resPayMeth}</td>
    <td>${item.resPayStat}</td>
    <td>${item.resStat}</td>
    `;
    reservData.appendChild(r);
    })
  }) 

  fetch('/room-data')
            .then(response => {
                if (response.ok) {
                    return response.json(); 
                } else {
                    throw new Error('Error fetching data');
                }
            })
            .then(data => {
                const selectElement = document.getElementById('selRoomR');
                document.getElementById('default').textContent = "";
                data.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.roomCost; 
                    option.textContent = item.roomName; 
                    selectElement.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });

fetch('/promo-data').then(response=>{
        if (response.ok){
            return response.json()
        }else{
            throw new Error('Error fetching data');
        }
    }).then(data=>{
        const selectE=document.getElementById('selPromo')
        document.getElementById("default-Promo")
        data.forEach(item=>{
            const option=document.createElement('option')
            option.value=item.proName
            option.textContent=item.proName
            selectE.appendChild(option)
        })
    }).catch(error => {
    console.error('Error fetching data:', error);
  });         


//#region room Array
let arrayFlag=0,arrayL,indexSel
let arrayPrice=0
const arrayR=[]
const arrayI=[]
const arrayD=[]
const arrayIP=[]
function more(){
    arrayR.push(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].textContent)
    arrayD.push({text:document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].textContent,index:arrayI.length})
    document.getElementById('roomArray').innerHTML=arrayD.map(item => `${item.text} <button class="btn" type="button" onclick="selectIndex(${item.index})">Select Item No. ${item.index}</button>`).join('<br>');
    arrayI.push(arrayI.length)
    var nuprice=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value)
    document.getElementById('selRoomR').selectedIndex=0
    arrayPrice=parseFloat(arrayPrice)+nuprice
    arrayL=arrayR.length
    if(arrayL>1){
        arrayFlag=1
    }else if(arrayL<=1){
        arrayFlag=0
    }
    document.getElementById('e').innerHTML=`Total Price: ${arrayPrice} <br> ArrayCount: ${arrayL}<br>${arrayR}<br>${arrayI}<br>Selected Index: ${indexSel}<br>Flag? ${arrayFlag}`
    document.getElementById('f').innerHTML=arrayD.map(item =>`${item.text}- ${item.index}`).join('<br>')
    var x,y,z
    if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           }
    var disPrice=parseFloat((x-y)+z)+parseFloat(arrayPrice)
    document.getElementById('price').value=disPrice.toFixed(2)
    document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value}`
}

function selectIndex(index){
    indexSel=index
    console.log("Selected: "+indexSel)
    document.getElementById('arrayRem').onclick=deletArray
}

function deletArray(){
    console.log(indexSel)
    if(indexSel!=-1){
        arrayD.splice(indexSel,1);
        const a=arrayR.splice(indexSel,1)
        arrayI.pop();
        arrayL=arrayR.length
        for(let i=0; i<arrayD.length;i++){
            arrayD[i].index=i
        }
        const selA=document.getElementById('selRoomR')
        var nuprice
        for(let i=0; i<selA.options.length; i++){
            alert(selA.options[i].text + " = "+ a)
                if(selA.options[i].text==a){
                    selA.selectedIndex=i
                    nuprice=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value)
                    break;
                }
               }
    arrayPrice=parseFloat(arrayPrice)-parseFloat(nuprice)
    if(arrayL>1){
        arrayFlag=1
    }else if(arrayL<=1){
        arrayFlag=0
    }
    document.getElementById('selRoomR').selectedIndex=0
        document.getElementById('roomArray').innerHTML=arrayD.map(item => `${item.text} <button class="btn" type="button" onclick="selectIndex(${item.index})">Select Item No. ${item.index}</button>`).join('<br>');
        document.getElementById('e').innerHTML=`Total Price: ${arrayPrice} <br> ArrayCount: ${arrayL}<br>${arrayR}<br>${arrayI}<br>Selected Index: ${indexSel}<br>Flag? ${arrayFlag}`
        document.getElementById('f').innerHTML=arrayD.map(item =>`${item.text}- ${item.index}`).join('<br>')
        var x,y,z
    if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           }
           var disPrice=parseFloat((x-y)+z)+parseFloat(arrayPrice)
           alert(arrayPrice+" "+disPrice)
    document.getElementById('price').value=disPrice.toFixed(2)
    document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value}`
    indexSel=undefined
    document.getElementById('arrayRem').onclick=reduce
    }
}


function reduce(){
    console.log(indexSel)
    if(arrayR.length===0){
        return
    }
    var a=arrayR.pop()
    arrayI.pop()
    arrayD.pop()
    document.getElementById('roomArray').innerHTML=`${arrayR.join(`<br>`)}`
    document.getElementById('roomArray').innerHTML=arrayD.map(item => `${item.text} <button class="btn" type="button" onclick="selectIndex(${item.index})">Select Item No. ${item.index}</button>`).join('<br>');
    const selA=document.getElementById('selRoomR')
    for(let i=0; i<selA.options.length; i++){
                if(selA.options[i].text===a){
                    alert(selA.options[i].value)
                    selA.selectedIndex=i
                    break;
                }
    }
    var nuprice=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value)
    document.getElementById('selRoomR').selectedIndex=0
    arrayPrice=parseFloat(arrayPrice)-nuprice
    arrayL=arrayR.length
    if(arrayL>1){
        arrayFlag=1
    }else if(arrayL<=1){
        arrayFlag=0
    }
    document.getElementById('e').innerHTML=`Total Price: ${arrayPrice} <br> ArrayCount: ${arrayL}<br>${arrayR}<br>${arrayI}<br>Selected Index: ${indexSel}<br>Flag? ${arrayFlag}`
    document.getElementById('f').innerHTML=arrayD.map(item =>`${item.text}- ${item.index}`).join('<br>')
    var x,y,z
    if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           }
           var disPrice=parseFloat((x-y)+z)+parseFloat(arrayPrice)
    document.getElementById('price').value=disPrice.toFixed(2)
    document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value}`
    }

//#endregion

  //#region Event Listeners

  document.getElementById('selRoomR').addEventListener('change', function() {
        const selectedOption = parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           const price=document.getElementById('price');
           var x,y;
           if(arrayL==undefined || arrayL==0){
            if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
           } 
           var nuPrice=((x+selectedOption)-y)+arrayPrice;
           price.value=nuPrice.toFixed(2);
           if (document.getElementById('selRoomR').value==""){
            price.value="300"
           }
           }else{
            if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
           } 
           var nuPrice=(x-y)+arrayPrice;
           price.value=nuPrice.toFixed(2);
           document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value}`
           if (document.getElementById('selRoomR').value==""){
            document.getElementById('pricePlus').textContent="0"
           }
           }
        });

        document.getElementById('pax').addEventListener('change',function(){
            if(document.getElementById('pax').value <=0){
                document.getElementById('pax').value=1
            }
            const priceText=document.getElementById('price');
            var x,y,z;
            if(arrayL==undefined || arrayL==0){
                if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           } 
           if(x<y){
            document.getElementById('cax').value=document.getElementById('pax').value
           }else if(x==y){
            document.getElementById('cax').value=document.getElementById('cax').value-1
            if( document.getElementById('cax').value <=0){
                document.getElementById('cax').value=0
            }
           }else{
            var nuPrice=((x-y)+z)+arrayPrice;
           priceText.value=nuPrice.toFixed(2);
           }
            }else{
                //if array is 1, cuz there's gonna be more
                if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           } 
           if(x<y){
            document.getElementById('cax').value=document.getElementById('pax').value
           }else if(x==y){
            document.getElementById('cax').value=document.getElementById('cax').value-1
            if( document.getElementById('cax').value <=0){
                document.getElementById('cax').value=0
            }
           }else{
            var nuPrice=(x-y)+arrayPrice;
           priceText.value=nuPrice.toFixed(2);
           document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value}`
           }
            }
        });

        document.getElementById('cax').addEventListener('change',function(){
            if( document.getElementById('cax').value <=0){
                document.getElementById('cax').value=0
            }
            const priceText=document.getElementById('price');
            var x,y,z;
            if(arrayL==undefined || arrayL==0){
                if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value);
           } 
           if(x<y){
            document.getElementById('cax').value=document.getElementById('pax').value
           }else if(x==y){
            document.getElementById('cax').value=document.getElementById('cax').value-1
            if( document.getElementById('cax').value <=0){
                document.getElementById('cax').value=0
            }
           }else{
            var nuPrice=((x-y)+z)+arrayPrice;
           priceText.value=nuPrice.toFixed(2);
           }
            }else{
                //arrayCount is 1, and there's gonna be more
                if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
           } 
           if(x<y){
            document.getElementById('cax').value=document.getElementById('pax').value
           }else if(x==y){
            document.getElementById('cax').value=document.getElementById('cax').value-1
            if( document.getElementById('cax').value <=0){
                document.getElementById('cax').value=0
            }
           }else{
            var nuPrice=(x-y)+arrayPrice;
           priceText.value=nuPrice.toFixed(2);
           document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value}`
           }
            }
        });

//#endregion

//#region days away from checkin to bookin
document.getElementById('book-in').addEventListener('change',function(){
const tour=document.getElementById('selTour')
var days=parseInt(document.getElementById('daysaf').value);
const checkedA=new Date(document.getElementById('book-in').value)
            
if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value=="WalkIn"){
                checkedA.setDate(checkedA.getDate()+days)
}else{
                checkedA.setDate(checkedA.getDate()+1+days)
            }

const checkedB=new Date(document.getElementById('book-in').value)

if(document.getElementById('check-in').valueAsDate<document.getElementById('book-in').valueAsDate){
                document.getElementById('check-in').valueAsDate=document.getElementById('book-in').valueAsDate
                document.getElementById('check-out').valueAsDate=document.getElementById('book-in').valueAsDate
if(tour.options[tour.selectedIndex].textContent!==""){
    if(tour.options[tour.selectedIndex].textContent=="Day Tour"){
        document.getElementById('check-out').valueAsDate=checkedA
        document.getElementById('check-in').valueAsDate=checkedB
    }else if(tour.options[tour.selectedIndex].textContent=="Night Tour"){
        document.getElementById('check-out').valueAsDate=checkedA
        document.getElementById('check-in').valueAsDate=checkedB
    }else if(tour.options[tour.selectedIndex].textContent=="Overnight"){
        document.getElementById('check-in').valueAsDate=checkedB
    }
    
}
if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value!="WalkIn"){
    document.getElementById('check-out').valueAsDate=checkedA
    checkedB.setDate(checkedB.getDate()+1)
    document.getElementById('check-in').valueAsDate=checkedB
}
}else if(document.getElementById('check-in').valueAsDate>document.getElementById('book-in').valueAsDate){
    if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value=="WalkIn"){
        document.getElementById('check-in').valueAsDate=document.getElementById('book-in').valueAsDate
                document.getElementById('check-out').valueAsDate=document.getElementById('book-in').valueAsDate
    }else{
        return
    }
}

if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value=="WalkIn"){
                checkedB.setDate(checkedB.getDate())
}else{
                checkedB.setDate(checkedB.getDate()+1)
}

if(tour.options[tour.selectedIndex].textContent!==""){
    document.getElementById('check-out').valueAsDate=checkedA
    document.getElementById('check-in').valueAsDate=checkedB
}
})
//post book-in

document.getElementById('check-in').addEventListener('change',function(){
    const tour=document.getElementById('selTour')
    var days=parseInt(document.getElementById('daysaf').value);
            const checkedA=new Date(document.getElementById('check-in').value)
            const checkedB=new Date(document.getElementById('check-in').value)
            
            if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value=="WalkIn"){
                checkedB.setDate(checkedB.getDate())
                checkedA.setDate(checkedA.getDate()+days)
            }else{
                const checkedCA=new Date(document.getElementById('check-in').value)
                const checkedCB=new Date(document.getElementById('book-in').value)
                if(checkedCA.getDate()>checkedCB.getDate()){
                    checkedA.setDate(checkedA.getDate()+days)
                    checkedB.setDate(checkedCB.getDate())
                }else if(checkedCA.getDate()<=checkedCB.getDate()){
                    checkedA.setDate(checkedA.getDate()+days)
                    checkedB.setDate(checkedB.getDate()-1)
                }
            }
            
        const checkedAB=new Date(document.getElementById('check-out').value)
        const checkedAC=checkedAB.getDate()-checkedA.getDate()
        if(tour.options[tour.selectedIndex].text=="Overnight"){
            if(checkedAC>days){
            days=checkedAC
            document.getElementById('daysaf').value=(days+1)
            checkedA.setDate(checkedA.getDate()+days)
        }
        }
        
            document.getElementById('check-out').valueAsDate=checkedA
            document.getElementById('book-in').valueAsDate =checkedB
        })

document.getElementById('check-out').addEventListener('change',function(){
    const tour=document.getElementById('selTour')
    const payM=document.getElementById('selPayMeth')
    var days=parseInt(document.getElementById('daysaf').value);
    const checkedA=new Date(document.getElementById('check-out').value)
    checkedA.setDate(checkedA.getDate()-days)
    const checkedB=new Date(document.getElementById('check-out').value)
    checkedB.setDate(checkedB.getDate()-days-1)
    const checkedAB=new Date(document.getElementById('check-in').value)
    const checkedAC=checkedA.getDate()-checkedAB.getDate()
    console.log(checkedA)
    console.log(checkedAB)
    console.log(checkedAC)

    if(tour.options[tour.selectedIndex].text=="Overnight"){
            console.log(days)
            if(checkedAC>days){
            days=checkedAC+days
            console.log(days)
            document.getElementById('daysaf').value=days
            console.log(checkedA)
            const checkedC=new Date(document.getElementById('check-out').value)
            checkedA.setDate(checkedC.getDate()-days)
            console.log(checkedA)
            checkedB.setDate(checkedC.getDate())   
            }else{
                console.log(days)
                document.getElementById('daysaf').value=days
            }
            
    }else if(tour.options[tour.selectedIndex].text=="Night Tour"){
        checkedA.setDate(checkedA.getDate()-days)
            console.log(checkedA)
    }
    if(payM.options[payM.selectedIndex].text=="Walk In"){
        const checkedC=document.getElementById('check-in').valueAsDate
        checkedB.setDate(checkedC.getDate())
    }
    document.getElementById('check-in').valueAsDate=checkedA
    document.getElementById('book-in').valueAsDate=checkedB
})

document.getElementById('daysaf').addEventListener('change',function(){
            var days=parseInt(document.getElementById('daysaf').value);
            const checkedA=new Date(document.getElementById('check-in').value)
            checkedA.setDate(checkedA.getDate()+days)

            const checkedB=new Date(document.getElementById('check-in').value)
            if(document.getElementById('check-in').valueAsDate<document.getElementById('book-in').valueAsDate){
                checkedB.setDate(document.getElementById('book-in').valueAsDate.getDate())
            }
            
            if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value=="WalkIn"){
                checkedB.setDate(checkedB.getDate())
            }else{
                const checkedCA=new Date(document.getElementById('check-in').value)
                const checkedCB=new Date(document.getElementById('book-in').value)
                if(checkedCA.getDate()>checkedCB.getDate()){
                    checkedB.setDate(checkedCB.getDate())
                }else if(checkedCA.getDate()<=checkedCB.getDate()){
                    checkedB.setDate(checkedB.getDate()-1)
                }
            }
            if(document.getElementById('check-in').value==""){

            }else{
                document.getElementById('check-out').valueAsDate=checkedA
                document.getElementById('book-in').valueAsDate = checkedB
            }
        })

document.getElementById('selPayMeth').addEventListener('change',function(){
if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value=="WalkIn"){
    document.getElementById('book-in').valueAsDate=document.getElementById('check-in').valueAsDate
}else{
    if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value=="WalkIn"){
        document.getElementById('book-in').valueAsDate=document.getElementById('check-in').valueAsDate
    }else{
        const checkedA=new Date(document.getElementById('check-in').value)
        const checkedB=new Date(document.getElementById('book-in').value)
       if(checkedA.getDate()>checkedB.getDate()){
        return
       }else if(checkedA.getDate()<=checkedB.getDate()){
        checkedA.setDate(checkedA.getDate()-1)
        document.getElementById('book-in').valueAsDate=checkedA
       } 
    }
}
})
//#endregion

//#region tours
document.getElementById('selTour').addEventListener('change',function(){
    if(document.getElementById('selTour').options[document.getElementById('selTour').selectedIndex].text=="Overnight"){
        document.getElementById('daysaf').value=1
        const checkedA=new Date(document.getElementById('check-in').value)
        checkedA.setDate(checkedA.getDate()+1)
        document.getElementById('check-out').valueAsDate=checkedA
        document.getElementById('daysaf').readOnly=false
    }else if(document.getElementById('selTour').options[document.getElementById('selTour').selectedIndex].text=="Night Tour"){
        document.getElementById('daysaf').value=1
        const checkedA=new Date(document.getElementById('check-in').value)
        checkedA.setDate(checkedA.getDate()+1)
        document.getElementById('check-out').valueAsDate=checkedA
        document.getElementById('daysaf').readOnly=true
    }else if(document.getElementById('selTour').options[document.getElementById('selTour').selectedIndex].text=="Day Tour"){
        document.getElementById('daysaf').value=0
        const checkedA=new Date(document.getElementById('check-in').value)
        checkedA.setDate(checkedA.getDate())
        document.getElementById('check-out').valueAsDate=checkedA
        document.getElementById('daysaf').readOnly=true
    }
})
//#endregion

//#region reservation control functions
async function updateRoom(){
    if(arrayFlag!=1){
        const roomName=document.getElementById('selRoomR').options[selRoomR.selectedIndex].text;
        if(roomName !=""){
            let roomCostf,roomSizef,roomReservdf,roomLeftf
        try{
            const response=await fetch(`/searchRoom?roomName=${roomName}`);
            const result=await response.json();
            if(response.ok){
                roomCostf=result.roomCost
                roomSizef=result.roomSize
                roomReservdf=result.roomReservd
                roomLeftf=result.roomLeft
            }else{
                alert("E-E-ERROR! ",result.error);
            }
        }catch(err){
            console.error("Error looking through the Database. ",err);
            alert('someone tripped over the wires!');
        }
        const roomLeftI=ameLeftf-1
        if(roomLeftI==0){
            const ameSizeI="Unavailable"
        }
        if(roomLeftI>=0){
            const up={
            roomName:roomName,
            roomSize:roomSizef,
            roomCost:roomCostf,
            roomReservd:roomReservdf,
            roomLeft:roomLeftI
        }
        try{
            const response = await fetch('/updateRoom',{
            method:'PATCH',
            headers:{
                'Content-Type':'application/json'
            },
            body:JSON.stringify(up),
            });
            const result=await response.json();
            if (response.ok){
                console.log("success")
            }else{
                alert(result.error);
            }
        }catch(err){
            console.error('E-E-ERROR! ',err);
            alert('An Error Occured While updating The Record.');
        }
        }
        }else{
            alert("Please input what to update.");
        }
    }else{
        for(let i=0;i<arrayL;i++){
            const roomName=arrayR[i]
        if(roomName !=""){
            let roomCostf,roomSizef,roomReservdf,roomLeftf
        try{
            const response=await fetch(`/searchRoom?roomName=${ameName}`);
            const result=await response.json();
            if(response.ok){
                roomCostf=result.roomCost
                roomSizef=result.roomSize
                roomReservdf=result.roomReservd
                roomLeftf=result.roomLeft
            }else{
                alert("E-E-ERROR! ",result.error);
            }
        }catch(err){
            console.error("Error looking through the Database. ",err);
            alert('someone tripped over the wires!');
        }
        const roomLeftI=ameLeftf-1
        if(roomLeftI==0){
            const ameSizeI="Unavailable"
        }
        if(roomLeftI>=0){
            const up={
            roomName:roomName,
            roomSize:roomSizef,
            roomCost:roomCostf,
            roomReservd:roomReservdf,
            roomLeft:roomLeftI
        }
        try{
            const response = await fetch('/updateRoom',{
            method:'PATCH',
            headers:{
                'Content-Type':'application/json'
            },
            body:JSON.stringify(up),
            });
            const result=await response.json();
            if (response.ok){
                console.log("success")
            }else{
                alert(result.error);
            }
        }catch(err){
            console.error('E-E-ERROR! ',err);
            alert('An Error Occured While updating The Record.');
        }
        }
        }else{
            alert("Please input what to update.");
        }
        }
    }
    }

function validator1(){
    document.getElementById('inProgInd').hidden=false;
    if(arrayFlag==0){
        if(arrayL==1){
        const a=arrayR
        const selA=document.getElementById('selRoomR')
        for(let i=0; i<selA.options.length; i++){
            if(selA.options[i].text===a){
                selA.selectedIndex=i
                break;
                }
            }   
        }
        return validator2A()
    }else{
        return validator2B()
    }
}

function validator2A(){
    const ID=document.getElementById('resID');
            const rescID = document.getElementById('username');
            const rescName = document.getElementById('fullname');
            const resPax=document.getElementById('pax');
            const resCax=document.getElementById('cax');
            const resRoomName=document.getElementById('selRoomR');
            const resCheckinDate=document.getElementById('check-in');
            const resCheckoutDate=document.getElementById('check-out')
            const resBookeDate=document.getElementById('book-in')
            const resTour=document.getElementById('selTour');
            const resPayMeth=document.getElementById('selPayMeth');
            const rescEmail=document.getElementById('email');
            const rescphono=document.getElementById('phono');
            const resPayStat=document.getElementById('selPayStat');
            const resPrice=document.getElementById('price')
            const resPromo=document.getElementById('selPromo')
            const resStat=document.getElementById('selResStat')
            if(rescID.value==""||rescName.value==""||resPax.value==""||resCax.value==""||resRoomName.value==""||resCheckinDate.value==""||resCheckoutDate.value=="" || resBookeDate.value==""||resTour.value==""||resPayMeth.value==""||rescphono.value==""||rescEmail.value=="" || resPayStat.value=="" || resStat.value=="" || resPrice.value==""){
                alert("Please fill all the transaction details fields.");
                document.getElementById('inProgInd').hidden=true;
            }else{
                const dte = resCheckDate.valueAsDate.toLocaleDateString('en-US', { year: '2-digit', month: '2-digit', day: '2-digit' }).replace(/\//g, '');
            var today = new Date(dt.getFullYear(), dt.getMonth(), dte.getDate());
        if(resCheckinDate.valueAsDate >= today){
            ID.value=rescID.value[0]+rescName.value[0]+dat
                return insertRes()
            }else{
                alert("Please put valid date.")
                document.getElementById('inProgInd').hidden=true;
            }
        }
}

function validator2B(){
            const ID=document.getElementById('resID');
            const rescID = document.getElementById('username');
            const rescName = document.getElementById('fullname');
            const resPax=document.getElementById('pax');
            const resCax=document.getElementById('cax');
            const resRoomName=document.getElementById('selRoomR');
            const resCheckinDate=document.getElementById('check-in');
            const resCheckoutDate=document.getElementById('check-out')
            const resBookeDate=document.getElementById('book-in')
            const resTour=document.getElementById('selTour');
            const resPayMeth=document.getElementById('selPayMeth');
            const rescEmail=document.getElementById('email');
            const rescphono=document.getElementById('phono');
            const resPayStat=document.getElementById('selPayStat');
            const resPrice=document.getElementById('price')
            const resPromo=document.getElementById('selPromo')
            const resStat=document.getElementById('selResStat')
            if(rescID.value==""||rescName.value==""||resPax.value==""||resCax.value==""||resCheckinDate.value=="" ||resCheckoutDate.value==""|| resBookeDate.value==""||resTour.value==""||resPayMeth.value==""||rescphono.value==""||rescEmail.value=="" || resPayStat.value=="" || resPrice.value=="" || resStat.value==""){
                alert("Please fill all the transaction details fields.");
                document.getElementById('inProgInd').hidden=true;
            }else{
                if(resCheckinDate.valueAsDate >= today){
            ID.value=rescID.value[0]+rescName.value[0]+dat
                return insertRes()
                }else{
                    alert("Please input valid date")
                    document.getElementById('inProgInd').hidden=true;
                }
            }
}

let conflict
async function insertRes(){
    await searchRA()
            if(sameDateFlag==true){
                conflict="there being a conflict with the Schedule"
            }else if(emptyFlag){
                conflict=`no more available instances of ${ameE}`
            }
            if(sameFlag==true && sameDateFlag==true || emptyFlag==true){
                alert(`Unable to proceed due to ${conflict}.`)
                document.getElementById('inProgInd').hidden=true;
            }else{
            const ID=document.getElementById('resID');
            const rescID = document.getElementById('username');
            const rescName = document.getElementById('fullname');
            const resPax=document.getElementById('pax');
            const resCax=document.getElementById('cax');
            const resRoomName=document.getElementById('selRoomR');
            const resCheckinDate=document.getElementById('check-in');
            const resCheckoutDate=document.getElementById('check-out')
            const resBookeDate=document.getElementById('book-in')
            const resTour=document.getElementById('selTour');
            const resPayMeth=document.getElementById('selPayMeth');
            const rescEmail=document.getElementById('email');
            const rescphono=document.getElementById('phono');
            const resPayStat=document.getElementById('selPayStat');
            const resPrice=document.getElementById('price')
            const resPromo=document.getElementById('selPromo')
            const resStat=document.getElementById('selResStat')
            let roomName
            if(arrayFlag==0){
                resRoom=resRoomName.options[resRoomName.selectedIndex].text
            }else{
                resRoom=arrayR
            }
        const datum={
            resID:ID.value,
            resmID:rescID.value,
            resmName:rescName.value,
            resmEmail:rescEmail.value,
            resmPhono:rescphono.value,
            resPax:resPax.value,
            resCax:resCax.value,
            resRoomName:resRoom,
            resCheckinDate:resCheckinDate.value,
            resCheckoutDate:resCheckoutDate.value,
            resBookeDate:resBookeDate.value,
            resTour:resTour.value,
            resPrice:resPrice.value,
            resPromo:resPromo.value,
            resPayMeth:resPayMeth.value,
            resPayStat:resPayStat.value,
            resStat:resStat.value
        }
        try{
            const response = await fetch('/insertRes',{
            method:'POST',
            headers:{
                'Content-Type':'application/json'
            },
            body:JSON.stringify(datum),
            });
            const result=await response.json();
            if (response.ok){
                alert(result.message);
                document.getElementById('fomres').reset();
                location.reload();
            }else{
                alert(result.error);
                document.getElementById('inProgInd').hidden=true;
            }
        }catch(err){
            console.error('E-E-ERROR! ',err);
            alert('An Error Occured While Inserting The Record.');
            document.getElementById('inProgInd').hidden=true;
        }
        
        }
        }

    let sameFlag,ameE,sameDateFlag,emptyFlag,diffResFlag
async function searchRA() {
    if(arrayFlag!=1){
        const ameI = document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].text;
    const ameResI=document.getElementById("username").value
    try {
        const response = await fetch('/room-data');
        const result = await response.json();
        if (response.ok) {
            for (const item of result) {
                const ame = item.roomName;
                const motoRes = await fetch(`/searchResRoom?resRoomName=${ame}`);
                const zuttoRes = await motoRes.json();
                if (motoRes.ok && Array.isArray(zuttoRes.data)) {
                    for (const res of zuttoRes.data) {
                        const ameF = res.resRoomName;
                        const checkF = res.resCheckinDate;
                        const ameResdF=res.rescIDf
                        console.log(ameF + " " + ame + " "+ ameI)
                        if (ameF == ame && ame == ameI && ameResI!=ameResdF){
                            sameFlag = true;
                            ameS = ameF;
                            diffResFlag=true
                            const checkI = document.getElementById('check-in').value;
                            if (checkF==checkI) {
                                sameDateFlag = true;
                            }
                        }
                    }
                }else if(motoRes.ok && !Array.isArray(zuttoRes.data)){
                    const ameF = zuttoRes.resRoomName;
                        const checkF = zuttoRes.resCheckinDate;
                        console.log(ameF + " " + ame + " "+ ameI)
                        if (ameF == ame && ame == ameI) {
                            sameFlag = true;
                            ameS = ameF;
                            const checkI = document.getElementById('check-in').value;
                            if (checkF == checkI) {
                                sameDateFlag = true;
                            }
                        }
                }
                if (ameI == ame && item.ameLeft == 0) {
                    emptyFlag = true;
                    ameE = ameI;
                }
            }
            console.log("Empty Flag:"+emptyFlag)
            console.log("Same Flag:"+sameFlag)
            console.log("Same Date Flag:"+sameDateFlag)
            console.log("Different Guy:"+diffResFlag)
        } else {
            console.error('Response not okay:', response.statusText);
        }
    } catch (err) {
        console.error('Error:', err);
    }
    } else{
        for(let i=0; i<arrayL;i++){
            const ameI = arrayR[i]
            const ameResI=document.getElementById("username").value
    try {
        const response = await fetch('/room-data');
        const result = await response.json();
        if (response.ok) {
            for (const item of result) {
                const ame = item.roomName;
                const motoRes = await fetch(`/searchResRoom?resRoomName=${ame}`);
                const zuttoRes = await motoRes.json();
                if (motoRes.ok && Array.isArray(zuttoRes.data)) {
                    for (const res of zuttoRes.data) {
                        const ameF = res.resRoomName;
                        const checkF = res.resCheckinDate;
                        const ameResdF=res.rescIDf
                        console.log(ameF + " " + ame + " "+ ameI)
                        if (ameF == ame && ame == ameI && ameResI!=ameResdF){
                            sameFlag = true;
                            ameS = ameF;
                            diffResFlag=true
                            const checkI = document.getElementById('check-in').value;
                            if (checkF==checkI) {
                                sameDateFlag = true;
                            }
                        }
                    }
                }else if(motoRes.ok && !Array.isArray(zuttoRes.data)){
                    const ameF = zuttoRes.resRoomName;
                        const checkF = zuttoRes.resCheckinDate;
                        console.log(ameF + " " + ame + " "+ ameI)
                        if (ameF == ame && ame == ameI) {
                            sameFlag = true;
                            ameS = ameF;
                            const checkI = document.getElementById('check-in').value;
                            if (checkF == checkI) {
                                sameDateFlag = true;
                            }
                        }
                }
                if (ameI == ame && item.ameLeft == 0) {
                    emptyFlag = true;
                    ameE = ameI;
                }
            }
            console.log("Empty Flag:"+emptyFlag)
            console.log("Same Flag:"+sameFlag)
            console.log("Same Date Flag:"+sameDateFlag)
            console.log("Different Guy:"+diffResFlag)
        } else {
            console.error('Response not okay:', response.statusText);
        }
    } catch (err) {
        console.error('Error:', err);
    }
        }
    }
    
}
    async function searchR(){
        const resID=document.getElementById('resID');
        if(resID.value==""){
            alert("Please input what you want to search")
        }else{
            const resIDf=document.getElementById('resID').value;
            let rescIDf
        try{
            const response=await fetch(`/searchRes?resID=${resIDf}`);
            const result=await response.json();
            if(response.ok){
               document.getElementById('username').value=result.resmID
               rescIDf=result.resmID
               document.getElementById('fullname').value=result.resmName
               document.getElementById('email').value=result.resmEmail
               document.getElementById('phono').value=result.resmPhono
               document.getElementById('pax').value=result.resPax
               document.getElementById('cax').value=result.resCax
               if(Array.isArray(result.resRoomName)){
                const selA=document.getElementById('selRoomR');
                for(let e=0; e<result.resRoomName.length;e++){
                const resA=result.resRoomName[e];
                for(let i=0; i<selA.options.length; i++){
                if(selA.options[i].text===resA){
                    selA.selectedIndex=i
                    arrayR.push(resA)
                    arrayD.push({text:resA,index:arrayI.length})
                    arrayI.push(arrayI.length)
                    arrayIP.push(arrayIP.length)
                    arrayL=arrayR.length
                    if(arrayL>1){
                        arrayFlag=1
                    }else if(arrayL<=1){
                    arrayFlag=0
                    }
                    var nuprice=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value)
                    arrayPrice=parseFloat(arrayPrice)+nuprice
                    document.getElementById('roomArray').innerHTML=arrayD.map(item => `${item.text} <button class="btn" type="button" id="index${item.index}" onclick="selectIndex(${item.index})">Select Item No. ${item.index}</button>`).join('<br>');
                    document.getElementById('e').innerHTML=`Total Price: ${arrayPrice} <br> ArrayCount: ${arrayL}<br>${arrayR}<br>${arrayI}<br>Selected Index: ${indexSel}<br>Flag? ${arrayFlag}`
                    document.getElementById('f').innerHTML=arrayD.map(item =>`${item.text}- ${item.index}`).join('<br>')
                    
                    document.getElementById('selRoomR').selectedIndex=0
                    break;
                     }
                    }
                }
               }else{
                const selA=document.getElementById('selRoomR');
                const resA=result.resRoomName;
                for(let i=0; i<selA.options.length; i++){
                if(selA.options[i].text===resA){
                    selA.selectedIndex=i
                    arrayR.push(resA)
                    arrayD.push({text:resA,index:arrayI.length})
                    arrayI.push(arrayI.length)
                    arrayIP.push(arrayIP.length)
                    arrayL=arrayR.length
                    document.getElementById('roomArray').innerHTML=arrayD.map(item => `${item.text} <button class="btn" type="button" id="index${item.index}" onclick="selectIndex(${item.index})">Select Item No. ${item.index}</button>`).join('<br>');
                    var nuprice=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value)
                    arrayPrice=parseFloat(arrayPrice)+nuprice
                    document.getElementById('e').innerHTML=`Total Price: ${arrayPrice} <br> ArrayCount: ${arrayL}<br>${arrayR}<br>${arrayI}<br>Selected Index: ${indexSel}<br>Flag? ${arrayFlag}`
                    document.getElementById('f').innerHTML=arrayD.map(item =>`${item.text}- ${item.index}`).join('<br>')
                    document.getElementById('selRoomR').selectedIndex=0
                                
                    break;
                }
                }
               }
               document.getElementById('check-in').value=result.resCheckinDate
               document.getElementById('check-out').value=result.resCheckoutDate
               document.getElementById('book-in').value=result.resBookeDate
               document.getElementById('selTour').value=result.resTour
               document.getElementById('price').value=result.resPrice
               document.getElementById('selPromo').value=result.resPromo
               document.getElementById('selPayMeth').value=result.resPayMeth
               document.getElementById('selPayStat').value=result.resPayStat
               searchFlag=true;
               const lock=document.getElementById('price')
               lock.readOnly=false;
               const selStat=document.getElementById('selResStat')
               const selStatf=result.resStat
               for(let e=0;e<selStat.options.length;e++){
                if(selStatf==selStat.options[e].text){
                    selStat.selectedIndex=e
                    break
                }
               }
            }else{
                alert("E-E-ERROR! ",result.error);
            }

        }catch(err){
            console.error("Error looking through the Database. ",err);
            alert('someone tripped over the wires!');
        }
        }
    }

    async function searchRes(resID){
            const resIDf=resID
            document.getElementById('resID').value=resIDf
        try{
            const response=await fetch(`/searchRes?resID=${resIDf}`);
            const result=await response.json();
            if(response.ok){
               document.getElementById('username').value=result.resmID
               rescIDf=result.resmID
               document.getElementById('fullname').value=result.resmName
               document.getElementById('email').value=result.resmEmail
               document.getElementById('phono').value=result.resmPhono
               document.getElementById('pax').value=result.resPax
               document.getElementById('cax').value=result.resCax
               if(Array.isArray(result.resRoomName)){
                const selA=document.getElementById('selRoomR');
                for(let e=0; e<result.resRoomName.length;e++){
                const resA=result.resRoomName[e];
                for(let i=0; i<selA.options.length; i++){
                if(selA.options[i].text===resA){
                    selA.selectedIndex=i
                    arrayR.push(resA)
                    arrayD.push({text:resA,index:arrayI.length})
                    arrayI.push(arrayI.length)
                    arrayIP.push(arrayIP.length)
                    arrayL=arrayR.length
                    if(arrayL>1){
                        arrayFlag=1
                    }else if(arrayL<=1){
                    arrayFlag=0
                    }
                    var nuprice=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value)
                    arrayPrice=parseFloat(arrayPrice)+nuprice
                    document.getElementById('roomArray').innerHTML=arrayD.map(item => `${item.text} <button class="btn" type="button" id="index${item.index}" onclick="selectIndex(${item.index})">Select Item No. ${item.index}</button>`).join('<br>');
                    document.getElementById('e').innerHTML=`Total Price: ${arrayPrice} <br> ArrayCount: ${arrayL}<br>${arrayR}<br>${arrayI}<br>Selected Index: ${indexSel}<br>Flag? ${arrayFlag}`
                    document.getElementById('f').innerHTML=arrayD.map(item =>`${item.text}- ${item.index}`).join('<br>')
                    
                    document.getElementById('selRoomR').selectedIndex=0
                    break;
                     }
                    }
                }
               }else{
                const selA=document.getElementById('selRoomR');
                const resA=result.resRoomName;
                for(let i=0; i<selA.options.length; i++){
                if(selA.options[i].text===resA){
                    selA.selectedIndex=i
                    arrayR.push(resA)
                    arrayD.push({text:resA,index:arrayI.length})
                    arrayI.push(arrayI.length)
                    arrayIP.push(arrayIP.length)
                    arrayL=arrayR.length
                    document.getElementById('roomArray').innerHTML=arrayD.map(item => `${item.text} <button class="btn" type="button" id="index${item.index}" onclick="selectIndex(${item.index})">Select Item No. ${item.index}</button>`).join('<br>');
                    var nuprice=parseFloat(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value)
                    arrayPrice=parseFloat(arrayPrice)+nuprice
                    document.getElementById('e').innerHTML=`Total Price: ${arrayPrice} <br> ArrayCount: ${arrayL}<br>${arrayR}<br>${arrayI}<br>Selected Index: ${indexSel}<br>Flag? ${arrayFlag}`
                    document.getElementById('f').innerHTML=arrayD.map(item =>`${item.text}- ${item.index}`).join('<br>')
                    document.getElementById('selRoomR').selectedIndex=0
                                
                    break;
                }
                }
               }
               document.getElementById('check-in').value=result.resCheckinDate
               document.getElementById('check-out').value=result.resCheckoutDate
               document.getElementById('book-in').value=result.resBookeDate
               document.getElementById('selTour').value=result.resTour
               document.getElementById('price').value=result.resPrice
               document.getElementById('selPromo').value=result.resPromo
               document.getElementById('selPayMeth').value=result.resPayMeth
               document.getElementById('selPayStat').value=result.resPayStat
               searchFlag=true;
               const lock=document.getElementById('price')
               lock.readOnly=false;
               const selStat=document.getElementById('selResStat')
               const selStatf=result.resStat
               for(let e=0;e<selStat.options.length;e++){
                if(selStatf==selStat.options[e].text){
                    selStat.selectedIndex=e
                    break
                }
               }
            }else{
                alert("E-E-ERROR! ",result.error);
            }

        }catch(err){
            console.error("Error looking through the Database. ",err);
            alert('someone tripped over the wires!');
        }
        }


    async function updateR(){
        document.getElementById('inProgInd').hidden=false;
        const resID=document.getElementById('resID');
        if(resID.value==""){
            alert("Please input what you want to update")
            document.getElementById('inProgInd').hidden=true;
        }else{
            const resIDf=document.getElementById('resID').value;
            let rescIDf, rescNamef,resPaxf,resCaxf,rescEmailf,rescphonof,rescpassf,resCheckinDatef,resCheckoutDatef,resBookDatef,resTourf,resPricef,resPayMethf,resPayStatf,resStatf,resPromof
        try{
            const response=await fetch(`/searchRes?resID=${resIDf}`);
            const result=await response.json();
            if(response.ok){
                rescIDf=result.resmID
                rescNamef=result.resmName
                resPaxf=result.resPax
                resCaxf=result.resCax
                rescEmailf=result.resmEmail
                rescphonof=result.resmPhono
                resRoomNamef=result.resRoomName
                resCheckinDatef=result.resCheckinDate
                resCheckoutDatef=result.resCheckoutDate
                resBookDatef=result.resBookeDate
                resTourf=result.resTour
                resPricef=result.resPrice;
                resPromof=result.resPromo
                resPayMethf=result.resPayMeth
                resPayStatf=result.resPayStat
                resStatf=result.resStat
            }else{
                alert("E-E-ERROR! ",result.error);
                document.getElementById('inProgInd').hidden=true;
            }
        }catch(err){
            console.error("Error looking through the Database. ",err);
            alert('someone tripped over the wires!');
            document.getElementById('inProgInd').hidden=true;
        }
        if(document.getElementById('username').value!="" && document.getElementById('username').value!=rescIDf){
            rescIDf=document.getElementById('username').value
        }
        if(document.getElementById('fullname').value!="" && document.getElementById('fullname').value!=rescNamef){
            rescNamef=document.getElementById('fullname').value
        }
        if(document.getElementById('email').value!="" && document.getElementById('email').value!=rescEmailf){
            rescEmailf=document.getElementById('email').value   
        }
        if(document.getElementById('phono').value!="" && document.getElementById('phono').value!=rescphonof){
            rescphonof=document.getElementById('phono').value
        }
        if(document.getElementById('pax').value!="" && document.getElementById('pax').value!=resPaxf){
            resPaxf=document.getElementById('pax').value
        }
        if(document.getElementById('cax').value!="" && document.getElementById('cax').value!=resCaxf){
            resCaxf=document.getElementById('cax').value
        }
        if(document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value!="" && document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].value!=resRoomNamef || arrayFlag!=0 && arrayR!=resRoomNamef || arrayL>0 && arrayR!=resRoomNamef){
            if(arrayFlag==0){
                resRoomNamef=document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].textContent
            }else if(arrayL==1){
                const a=arrayR[0]
                const selA=document.getElementById('selRoomR')
                for(let i=0; i<selA.options.length; i++){
                if(selA.options[i].text===a){
                    selA.selectedIndex=i
                    break;
                    }
                }
               resRoomNamef=document.getElementById('selRoomR').options[document.getElementById('selRoomR').selectedIndex].textContent
            }else{
                resRoomNamef=arrayR
            }
        }
        if(document.getElementById("check-in").value!="" && document.getElementById('check-in').value!=resCheckinDatef){
            resCheckinDatef=document.getElementById("check-in").value
        }
        if(document.getElementById("check-out").value!="" && document.getElementById('check-out').value!=resCheckoutDatef){
            resCheckoutDatef=document.getElementById("check-out").value
        }
        if(document.getElementById('book-in').value!="" && document.getElementById('book-in').value!=resBookDatef){
            resBookDatef=document.getElementById('book-in').value
        }
        if(document.getElementById('selTour').options[document.getElementById('selTour').selectedIndex].text!="" && document.getElementById('selTour').options[document.getElementById('selTour').selectedIndex].text!=resTourf){
            resTourf=document.getElementById('selTour').options[document.getElementById('selTour').selectedIndex].value
        }
        if(document.getElementById('price').value!="" && document.getElementById('price').value!=resPricef){
           resPricef=document.getElementById('price').value 
        }

        if(document.getElementById('selPromo').options[document.getElementById('selPromo').selectedIndex].value!=resPromof){
            resPromof=document.getElementById('selPromo').options[document.getElementById('selPromo').selectedIndex].value
        }

        if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value!="" && document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value!=resPayMethf){
            resPayMethf=document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value
            
        }
        if(document.getElementById('selPayStat').options[document.getElementById('selPayStat').selectedIndex].value!="" && document.getElementById('selPayStat').options[document.getElementById('selPayStat').selectedIndex].value!=resPayStatf){
            resPayStatf=document.getElementById('selPayStat').options[document.getElementById('selPayStat').selectedIndex].value
             
        }
        if(document.getElementById('selResStat').options[document.getElementById('selResStat').selectedIndex].value!="" && document.getElementById('selResStat').options[document.getElementById('selResStat').selectedIndex].value!=resStatf){
            resStatf=document.getElementById('selResStat').options[document.getElementById('selResStat').selectedIndex].value
        }
        const updoot={
            resID:resIDf,
            resmID:rescIDf,
            resmName:rescNamef,
            resPax:resPaxf,
            resCax:resCaxf,
            resmEmail:rescEmailf,
            resmPhono:rescphonof,
            resRoomName:resRoomNamef,
            resCheckinDate:resCheckinDatef,
            resCheckoutDate:resCheckoutDatef,
            resBookeDate:resBookDatef,
            resTour:resTourf,
            resPrice:resPricef,
            resPromo:resPromof,
            resPayMeth:resPayMethf,
            resPayStat:resPayStatf,
            resStat:resStatf
        }
        console.log(updoot)
        try{
            const response = await fetch('/updateRes',{
            method:'PATCH',
            headers:{
                'Content-Type':'application/json'
            },
            body:JSON.stringify(updoot),
            });
            const result=await response.json();
            if (response.ok){
                alert(result.message);
                document.getElementById('fomres')
                location.reload();
                
            }else{
                alert(result.error);
                document.getElementById('inProgInd').hidden=true;
            }
        }catch(err){
            console.error('E-E-ERROR! ',err);
            alert('An Error Occured while updating The Record.');
        }
    }
    }
    
    async function deletR(){
                        const fomdat=new FormData(document.getElementById('fomres'));
        const datum=Object.fromEntries(fomdat.entries());
        try{
            const response = await fetch('/deletRes',{
            method:'POST',
            headers:{
                'Content-Type':'application/json'
            },
            body:JSON.stringify(datum),
            });
            const result=await response.json();
            if (response.ok){
                alert(result.message);
                    document.getElementById('fomres').reset();
            location.reload();
            }else{
                alert(result.error);
                document.getElementById('inProgInd').hidden=true;
            }
        }catch(err){
            console.error('E-E-ERROR! ',err);
            alert('An Error Occured While removing The Record.');
            document.getElementById('inProgInd').hidden=true;
        }
                    }
            
    async function logout(){
        const datum={
         it:"admin"   
        }
        try{
            const response=await fetch('/applyCurrentActive',{
            method:'POST',
            headers:{
            'Content-Type':'application/json'
            },
            body:JSON.stringify(datum)
            })
            if(response.ok){
                window.location.replace("LogIn.html")
            }
            }catch(err){
            console.log(err)
            }
    }
        
//#endregion

    </script>
    <footer>
        <p>&copy; (2014) Tubigan Garden Resort</p>
    </footer>
</body>
</html>
